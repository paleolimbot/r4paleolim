<!DOCTYPE html>
<html>
  <head>
    <title>R for Paleolimnology</title>
    <meta charset="utf-8">
    <meta name="author" content="Brent Thorne &amp; Dewey Dunnington" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/default-fonts.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# R for Paleolimnology
## PALS 2018 Workshop
### Brent Thorne &amp; Dewey Dunnington
### (2018-05-23)

---



background-image: url(https://funnytimes.com/wp-content/uploads/1995/10/199510043.jpg)
background-position: 95% 95%

# What You Will Learn

--

### 1. What is R and what is RStudio?

--

### 2. How do I get my data into R?

--

### 3. How to structure and transform your data

--

### 4. How to visualize your paleolimnological data

---

# Getting Started

--

## Wifi

Username: PALS &lt;br&gt;
Password: Brockpassword01

---
# Getting Started

Install **[R](https://cran.r-project.org/)** and **[RStudio](https://rstudio.com/)** onto your machince.

--

- *Feel free to ask for help!*

--

### Success!!

&lt;img src="https://www.w-t-w.org/en/wp-content/uploads/2014/02/Studying-Computer-Programming.jpg" width=200 align="middle"&gt;

---
# Tutorial 1 Basic R

![](https://paleolimbot.github.io/r4paleolim/01-Basic-R-Figs/r_console.png)

---

## Prerequisites

--

We will be using the &lt;a href="https://www.tidyverse.org/" target="_blank"&gt;&lt;img src="https://www.tidyverse.org/images/hex-tidyverse.png" width="100" align="middle"&gt;&lt;/a&gt; package:

--


```r
install.packages("tidyverse")

*library(tidyverse)
```

--

### Easy Right!

---

## Expressions

--


```r
1 + 1
```

```
## [1] 2
```

--


```r
2 * 5
```

```
## [1] 10
```

--


```r
2 * (5 + 1)
```

```
## [1] 12
```

---

## Variables

--


```r
x &lt;- 1 + 1
```

--


```r
x
```

```
## [1] 2
```

--


```r
x + 2
```

```
## [1] 4
```

---

## Character Vectors

```r
mytext &lt;- "I am text"

mytext
```

```
## [1] "I am text"
```

---

## Functions

An argument with an input which returns an output value.

--

Let's calculate a square root:


```r
sqrt(4)
```

```
## [1] 2
```

--

Find the largest number in a list:


```r
max(2, 6, 7, 2, 10)
```

```
## [1] 10
```

---

## Keyword Arguments


```r
paste("string1", "string2", sep = "_")
```

```
## [1] "string1_string2"
```

---

background-image: url(https://pics.me.me/it-doesnt-work-why-it-works-why-2349750.png)

---

## Functions (Help)

Use the `?` to call the help documentation to any function in R!


```r
?paste
```

---

## Functions (Help)

**Description**

Concatenate vectors after converting to character.

**Usage**

```
paste (..., sep = " ", collapse = NULL)
paste0(..., collapse = NULL)
```

**Arguments**
&lt;table&gt;&lt;tr valign="top"&gt;&lt;td&gt;&lt;code&gt;...&lt;/code&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;one or more &lt;span style="font-family: Courier New, Courier; color: #666666;"&gt;&lt;b&gt;R&lt;/b&gt;&lt;/span&gt; objects, to be converted to character vectors.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr valign="top"&gt;&lt;td&gt;&lt;code&gt;sep&lt;/code&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;a character string to separate the terms.  Not
&lt;code&gt;&lt;a href="NA.html"&gt;NA_character_&lt;/a&gt;&lt;/code&gt;.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr valign="top"&gt;&lt;td&gt;&lt;code&gt;collapse&lt;/code&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;an optional character string to separate the results.  Not
&lt;code&gt;&lt;a href="NA.html"&gt;NA_character_&lt;/a&gt;&lt;/code&gt;.&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;

---

## Vectors

--

Combine sets of numbers:


```r
myvector &lt;- c(10, 9, 8, 7, 2)
myvector
```

```
## [1] 10  9  8  7  2
```

--
Or do it with sets of characters:


```r
mytextvector &lt;- c("word1", "word2", "word3")
mytextvector
```

```
## [1] "word1" "word2" "word3"
```

--


```r
myothervector &lt;- 13:16
myothervector
```

```
## [1] 13 14 15 16
```

---

## Vectors


```r
start &lt;- 25
end &lt;- start + 5
start:end
```

```
## [1] 25 26 27 28 29 30
```

---

## Indexing

- What's inside our vector??

--


```r
myvector &lt;- c(10, 9, 8, 7, 2)
myvector[1]
```

```
## [1] 10
```

--


```r
myvector[5]
```

```
## [1] 2
```

---

## Indexing

- Indexing with a **vector**.

--

```r
 myvector[1:3]
```

```
## [1] 10  9  8
```

--

This is equivalent to:


```r
 myvector[c(1, 2, 3)]
```

```
## [1] 10  9  8
```

---
## Indexing

### TRUE/FALSE

--


```r
myvector[myvector &gt; 7]
```

```
## [1] 10  9  8
```

--


```r
myvector &gt; 7
```

```
## [1]  TRUE  TRUE  TRUE FALSE FALSE
```

---

## Missing Values

Missing values are represented in R using `NA`, or "not assigned".

--


```r
mean(c(NA, 1, 2, 3))
```

```
## [1] NA
```

--

Use the **argument** `na.rm = TRUE` to remoe `NA` values.


```r
mean(c(NA, 1, 2, 3), na.rm = TRUE)
```

```
## [1] 2
```

---

## Data Frames

The vast majority of data in R is kept in a **tibble** (often called a **data frame**), which is a collection of **vectors** of the same length. You can think of a **tibble** as a table, with each column in the table being of the same type (numeric, character, TRUE/FALSE, etc.).

--



```r
my_tibble &lt;- tibble(
  number = c(1, 2, 3), 
  name = c("one", "two", "three"),
  is_one = c(TRUE, FALSE, FALSE)
)
my_tibble
```

```
## # A tibble: 3 x 3
##   number name  is_one
##    &lt;dbl&gt; &lt;chr&gt; &lt;lgl&gt; 
## 1      1 one   TRUE  
## 2      2 two   FALSE 
## 3      3 three FALSE
```

---
## Data Frames

You can get these values as vectors again using the `$` operator, which allows you to extract a vector from a data frame.

--


```r
my_tibble$number
```

```
## [1] 1 2 3
```


```r
my_tibble$name
```

```
## [1] "one"   "two"   "three"
```


```r
my_tibble$is_one
```

```
## [1]  TRUE FALSE FALSE
```

---

## Loading Packages

Base R functionality is designed to provide basic functions to help with data analysis, but may add-ons are available and code you find online (including here, shortly) will often tell you to load a "package" using `library()`.

--


```r
library(packagename)
```

--

The `tidyverse` package actually installs and loads a family of useful packages for us, a list of which we can access using `tidyverse_packages()`. Try it!


```r
tidyverse_packages()
```

```
##  [1] "broom"       "cli"         "crayon"      "dplyr"       "dbplyr"     
##  [6] "forcats"     "ggplot2"     "haven"       "hms"         "httr"       
## [11] "jsonlite"    "lubridate"   "magrittr"    "modelr"      "purrr"      
## [16] "readr"       "readxl\n(&gt;=" "reprex"      "rlang"       "rstudioapi" 
## [21] "rvest"       "stringr"     "tibble"      "tidyr"       "xml2"       
## [26] "tidyverse"
```

---
## Loading Packages

If a packge you wish to use is not able to be loaded using `library()` it just means you nead to install it onto your computer first!


```r
install.packages("tidyverse")
```


---
## Script Editor

In reality, very little of the code you type will be directly in the prompt. Instead, you will use RStudio's script editor to run commands so that you can go back and edit them or run them from the beginning.

![Script Editor](https://raw.githubusercontent.com/paleolimbot/r4paleolim/master/01-Basic-R-Figs/r_editor.png)

---

## Environment

Use the **Environment** tab in RStudio to see which variables you have already assigned.

![](https://paleolimbot.github.io/r4paleolim/01-Basic-R-Figs/r_environment.png)

---

# Tutorial 2
# Working with Tables using the Tidyverse

- In this tutorial we will use the tidyverse to manipulate and summarise tabular data.

---

## Read in the Data

Let's bring in the data provided by Dewey Dunnington!


```r
halifax_geochem &lt;- read_csv(
  "http://paleolimbot.github.io/r4paleolim/data/halifax_geochem.csv",
  col_types = cols(.default = col_guess())
)
```

---
## Read in the Data

- The data contains several bulk geochemical parameters from a recent study of Halifax drinking water reservoirs&lt;sup&gt;1&lt;/sup&gt;, including Pockwock Lake, Lake Major, Bennery Lake, Lake Fletcher, Lake Lemont, First Chain Lake, First Lake, and Second Lake. (Later, we will take a look at the core locations as well as the geochemical data).

.footnote[
[1] Dunnington, Dewey W., I. S. Spooner, Wendy H. Krkošek, Graham A. Gagnon, R. Jack Cornett, Chris E. White, Benjamin Misiuk, and Drake Tymstra. 2018. “Anthropogenic Activity in the Halifax Region, Nova Scotia, Canada, as Recorded by Bulk Geochemistry of Lake Sediments.” [https://doi.org/10.1080/10402381.2018.1461715](https://doi.org/10.1080/10402381.2018.1461715)
]

---

## Viewing a Data Frame

The variable we have just created (halifax_geochem) is a tibble, which is a table of values much like you would find in a spreadsheet (you will notice that we loaded it directly from an Excel spreadhseet).

--


```r
View(halifax_geochem) # will display a graphic table browser
```


```r
glimpse(halifax_geochem) # will display a text summary of the object
```

```
## Observations: 326
## Variables: 9
## $ core_id       &lt;chr&gt; "BEN15-2", "BEN15-2", "BEN15-2", "BEN15-2", "BEN...
## $ depth_cm      &lt;dbl&gt; 0.0, 0.5, 1.0, 1.5, 2.0, 2.5, 3.0, 3.5, 4.0, 4.5...
## $ age_ad        &lt;dbl&gt; 2015.903, 2015.188, 2014.474, 2012.950, 2011.425...
## $ C_percent     &lt;dbl&gt; 14.75718, 14.65701, 14.94983, 14.54558, 14.40408...
## $ `C/N`         &lt;dbl&gt; 12.15765, 12.17829, 11.92338, 11.67900, 11.61200...
## $ d13C_permille &lt;dbl&gt; -30.24752, -30.31042, -30.35799, -30.33835, -30....
## $ d15N_permille &lt;dbl&gt; 2.461962, 2.447662, 2.336219, 2.528572, 2.662515...
## $ K_percent     &lt;dbl&gt; 1.0026000, 1.0857000, 0.9782000, 0.9423000, 1.07...
## $ Ti_percent    &lt;dbl&gt; 0.1693000, 0.1823000, 0.1678000, 0.1664000, 0.18...
```


```r
head(halifax_geochem) # will display the first few rows of the data
```

```
## # A tibble: 6 x 9
##   core_id depth_cm age_ad C_percent `C/N` d13C_permille d15N_permille
##   &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;
## 1 BEN15-2      0    2016.      14.8  12.2         -30.2          2.46
## 2 BEN15-2      0.5  2015.      14.7  12.2         -30.3          2.45
## 3 BEN15-2      1    2014.      14.9  11.9         -30.4          2.34
## 4 BEN15-2      1.5  2013.      14.5  11.7         -30.3          2.53
## 5 BEN15-2      2    2011.      14.4  11.6         -30.4          2.66
## 6 BEN15-2      2.5  2010.      14.4  11.9         -30.3          2.48
## # ... with 2 more variables: K_percent &lt;dbl&gt;, Ti_percent &lt;dbl&gt;
```

---

## Selecting Columns

- One way to subset `halifax_geochem` is to subset by column, for which we will use the `select()` function.

--

We may only be interested in the stable isotope information, represented by the columns `d13C_permille` and `d15N_permille`.


```r
stable_isotope_data &lt;- select(
  halifax_geochem, 
  core_id, depth_cm, age_ad, 
  d13C_permille, d15N_permille
)
```

---
## Select Columns

- The first argument to the `select()` function is the original data frame (in this case, `halifax_geochem`), and the remaining arguments are the names of the columns to be selected.

--

To select the `core_id`, `age_ad`, `Ti`, and `K` columns, you would use the following R command:


```r
geochem_data &lt;- select(halifax_geochem, core_id, depth_cm, age_ad, Ti_percent, K_percent)
```

---
## Select Columns

- Some column names in `halifax_geochem` contain characters that could be interpreted as an operation (e.g., `C/N`, which is the name of the column and not `C` divided by `N`).

--

- To select these columns, you will need to surround the column name in backticks:


```r
select(halifax_geochem, core_id, depth_cm, age_ad, `C/N`)
```

---
## Select Columns

### Exercises

- Use `View()`, `glimpse()`, and `head()` to preview the two data frames we just created. Do they have the columns you would expect?

- Use `select()` to select `core_id`, `depth_cm`, C/N, d13C, and d15N, and assign it to the variable `cn_data`.

--



---
## Filtering Rows

- Another way to subset `halifax_geochem` is by filtering rows using column values, similar to the filter feature in Microsoft Excel.
- This is done using the `filter()` function. For example, we may only be interested in the core from Pockwock Lake.


```r
pockwock_data &lt;- filter(halifax_geochem, core_id == "POC15-2")
```

--

- Passing multiple conditions means each row must satisfy all of the conditions, such that to obtain the data from core POC15-2 where the depth in the core was 0 cm, we can use the following call to `filter()`:


```r
pockwock_surface_data &lt;- filter(halifax_geochem, core_id == "POC15-2", depth_cm == 0)
```

---
## Filtering Rows

- It is very important that there are two equals signs within `filter()`!

- Other operators are: `&lt;=`, `&gt;=`, `&lt;`, `&gt;`, or `%in%`


```r
data_recent &lt;- filter(halifax_geochem, age_ad &gt;= 1950)
```

--

We could also find observations from multiple cores:


```r
pockwock_major_data &lt;- filter(halifax_geochem, core_id %in% c("POC15-2", "MAJ15-1"))
```

---
## Filtering Rows

### Exercises

- Use `View()`, `glimpse()`, and `head()` to preview the data frames we just created. Do they have the rows you would expect?

- Use `filter()` to find observations from the core FCL16-1 with an age between 1900 and present, and assign it to a name of your choosing.

- Are there any observations with a C/N value greater than 20? (hint: you will have to surround `C/N` in backticks)

--



---
## Selecting and Filtering

- Often we need to use both `select()` and `filter()` to obtain the desired subset of a data frame.

- To do this, we need to pass the result of `select()` to `filter()`, or the result of `filter()` to `select()`.

--

Let's create a data frame of recent (age greater than 1950) stable isotope measurements (you'll recall that we selected stable isotope columns in the data frame `stable_isotope_data`):


```r
recent_stable_isotopes &lt;- filter(stable_isotope_data, age_ad &gt;= 1950)
recent_stable_isotopes2 &lt;- select(
  data_recent,
  core_id, depth_cm, age_ad, 
  d13C_permille, d15N_permille
)
```

---
## Selecting and Filtering

### Exersices

- Use `View()`, `glimpse()`, and/or `head()` to verify that `recent_stable_isotopes` and `recent_stable_isotopes_2` are identical.

---
## The Pipe (%&gt;%)

Instead of creating intermediary variables every time we want to subset a data frame using `select()` and `filter()`, we can use the pipe operator (`%&gt;%`) to pass the result of one function call to another.

--


```r
recent_stable_isotopes_pipe &lt;- halifax_geochem %&gt;% 
  filter(age_ad &gt;= 1950) %&gt;%
  select(core_id, depth_cm, age_ad, d13C_permille, d15N_permille)
```

## The Pipe (%&gt;%)

### Exerscises

- Inspect `recent_stable_isotopes_pipe` to ensure it is identical to `recent_stable_isotopes`.
- Create a data frame of stable isotope data from surface samples (`depth_cm == 0`) using `halifax_geochem`, `filter()`, `select()`, and `%&gt;%` and assign it to a variable of a suitable name.

--



---
## Arranging (sorting) A Data Frame

- Sometimes it is desirable to view rows in a particular order, which can be used to quickly determine min and max values of various parameters.

This is done using the `arrange()` function. For example, it may make sense to view `halifax_geochem` in ascending `core_id` and `depth_cm` order (most recent first):

--


```r
halifax_geochem %&gt;%
  arrange(core_id, depth_cm)
```

```
## # A tibble: 326 x 9
##    core_id depth_cm age_ad C_percent `C/N` d13C_permille d15N_permille
##    &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;
##  1 BEN15-2      0    2016.      14.8  12.2         -30.2          2.46
##  2 BEN15-2      0.5  2015.      14.7  12.2         -30.3          2.45
##  3 BEN15-2      1    2014.      14.9  11.9         -30.4          2.34
##  4 BEN15-2      1.5  2013.      14.5  11.7         -30.3          2.53
##  5 BEN15-2      2    2011.      14.4  11.6         -30.4          2.66
##  6 BEN15-2      2.5  2010.      14.4  11.9         -30.3          2.48
##  7 BEN15-2      3    2008.      14.4  11.9         -30.3          2.53
##  8 BEN15-2      3.5  2005.      14.3  12.0         -30.2          2.60
##  9 BEN15-2      4    2002.      14.0  12.0         -30.2          2.60
## 10 BEN15-2      4.5  1999.      13.7  12.1         -30.2          2.48
## # ... with 316 more rows, and 2 more variables: K_percent &lt;dbl&gt;,
## #   Ti_percent &lt;dbl&gt;
```

--

Or descending depth order (most recent last):


```r
halifax_geochem %&gt;%
  arrange(core_id, desc(depth_cm))
```

# A tibble: 326 x 9
   core_id depth_cm age_ad C_percent `C/N` d13C_permille d15N_permille
   &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;
 1 BEN15-2       29  1742.      14.5  13.4         -29.3          3.54
 2 BEN15-2       28  1751.      14.5  13.5         -29.3          3.60
 3 BEN15-2       27  1759.      15.1  13.4         -29.4          3.60
 4 BEN15-2       26  1768.      15.9  13.5         -29.5          3.57
 5 BEN15-2       25  1776.      16.7  13.4         -29.6          3.42
 6 BEN15-2       24  1784.      16.8  13.4         -29.5          3.42
 7 BEN15-2       23  1793.      16.5  13.5         -29.4          3.39
 8 BEN15-2       22  1801.      17.2  13.4         -29.4          3.41
 9 BEN15-2       21  1810.      17.3  13.6         -29.4          3.22
10 BEN15-2       20  1818.      17.6  13.5         -29.4          3.18
# ... with 316 more rows, and 2 more variables: K_percent &lt;dbl&gt;,
#   Ti_percent &lt;dbl&gt;
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script>
(function() {
  var i, text, code, codes = document.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
})();
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
